<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wetter Widget</title>
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        body { background-color: transparent; font-family: sans-serif; }
        ::-webkit-scrollbar { width: 0px; background: transparent; }
    </style>
</head>
<body class="bg-gray-50 h-screen flex items-center justify-center overflow-hidden">

    <div id="root" class="w-full h-full flex items-center justify-center"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        const App = () => {
            const [weather, setWeather] = useState(null);
            const [locationName, setLocationName] = useState("Lade Standort...");
            const [loading, setLoading] = useState(true);
            const [error, setError] = useState(null);

            // Icons mapping (Simpler SVG approach for standalone file to avoid dependency issues)
            const Icons = {
                Sun: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="4"/><path d="M12 2v2"/><path d="M12 20v2"/><path d="m4.93 4.93 1.41 1.41"/><path d="m17.66 17.66 1.41 1.41"/><path d="M2 12h2"/><path d="M20 12h2"/><path d="m6.34 17.66-1.41 1.41"/><path d="m19.07 4.93-1.41 1.41"/></svg>,
                Cloud: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M17.5 19c0-3.037-2.463-5.5-5.5-5.5S6.5 15.963 6.5 19"/><path d="M17.5 19h-11"/><path d="M17.5 19a5.5 5.5 0 0 0 2.625-10.334"/><path d="M6.5 19a5.5 5.5 0 0 1-3.625-9.666"/><path d="M12 13.5V7"/></svg>,
                CloudRain: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242"/><path d="M16 14v6"/><path d="M8 14v6"/><path d="M12 16v6"/></svg>,
                CloudSnow: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242"/><path d="M8 15h.01"/><path d="M8 19h.01"/><path d="M12 17h.01"/><path d="M12 21h.01"/><path d="M16 15h.01"/><path d="M16 19h.01"/></svg>,
                CloudLightning: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M6 16.326A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 .5 8.973"/><path d="m13 12-3 5h4l-3 5"/></svg>,
                Droplets: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M7 16.3c2.2 0 4-1.83 4-4.05 0-1.16-.57-2.26-1.71-3.19S7.29 6.75 7 5.3c-.29 1.45-1.14 2.84-2.29 3.76S3 11.1 3 12.25c0 2.22 1.8 4.05 4 4.05z"/><path d="M12.56 6.6A10.97 10.97 0 0 0 14 3.02c.5 2.5 2 4.9 4 6.5s3 3.5 3 5.5a6.98 6.98 0 0 1-11.91 4.97"/></svg>,
                Wind: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M17.7 7.7a2.5 2.5 0 1 1 1.8 4.3H2"/><path d="M9.6 4.6A2 2 0 1 1 11 8H2"/><path d="M12.6 19.4A2 2 0 1 0 14 16H2"/></svg>,
                MapPin: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"/><circle cx="12" cy="10" r="3"/></svg>,
                ChevronLeft: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m15 18-6-6 6-6"/></svg>,
                ChevronRight: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m9 18 6-6-6-6"/></svg>
            };

            const getWeatherIcon = (code, className = "") => {
                const props = { className };
                if (code === 0) return { icon: <Icons.Sun {...props} />, label: "Klar" };
                if (code >= 1 && code <= 3) return { icon: <Icons.Cloud {...props} />, label: "Bewölkt" };
                if (code >= 45 && code <= 48) return { icon: <Icons.Cloud {...props} />, label: "Nebel" };
                if (code >= 51 && code <= 67) return { icon: <Icons.CloudRain {...props} />, label: "Regen" };
                if (code >= 71 && code <= 77) return { icon: <Icons.CloudSnow {...props} />, label: "Schnee" };
                if (code >= 80 && code <= 99) return { icon: <Icons.CloudRain {...props} />, label: "Regen" };
                return { icon: <Icons.Cloud {...props} />, label: "Trüb" };
            };

            const fetchWeather = async (lat, lon) => {
                try {
                    const weatherRes = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current=temperature_2m,relative_humidity_2m,weather_code,wind_speed_10m&hourly=temperature_2m,weather_code&daily=weather_code,temperature_2m_max,temperature_2m_min&timezone=auto`);
                    const data = await weatherRes.json();
                    
                    // Simple reverse geocoding via OpenStreetMap (Free, requires user agent usually but works for small client side)
                    try {
                        const geoRes = await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}`);
                        const geoData = await geoRes.json();
                        setLocationName(geoData.address.city || geoData.address.town || geoData.address.village || "Mein Standort");
                    } catch (e) {
                        setLocationName("Standort gefunden");
                    }

                    setWeather(data);
                    setLoading(false);
                } catch (err) {
                    setError("Fehler beim Laden");
                    setLoading(false);
                }
            };

            useEffect(() => {
                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(
                        (position) => fetchWeather(position.coords.latitude, position.coords.longitude),
                        (err) => {
                            // Fallback falls blockiert: Zürich
                            fetchWeather(47.37, 8.54); 
                            setLocationName("Zürich (Fallback)");
                        }
                    );
                } else {
                    // Fallback falls nicht unterstützt
                    fetchWeather(47.37, 8.54);
                    setLocationName("Zürich (Fallback)");
                }
            }, []);

            const getDayName = (dateStr) => {
                const days = ['Sonntag', 'Montag', 'Dienstag', 'Mittwoch', 'Donnerstag', 'Freitag', 'Samstag'];
                const d = new Date(dateStr);
                return days[d.getDay()];
            };

            const getHour = (iso) => new Date(iso).getHours() + ":00";

            if (loading) return <div className="flex h-full items-center justify-center text-blue-500 font-sans">Wetter wird geladen...</div>;

            const current = getWeatherIcon(weather.current.weather_code, "w-12 h-12 text-blue-600");

            return (
                <div className="w-full max-w-sm rounded-3xl overflow-hidden shadow-lg bg-white font-sans text-slate-800">
                    {/* TOP SECTION */}
                    <div className="bg-blue-200 p-6">
                        <div className="flex justify-between items-start">
                            <div className="flex items-center space-x-1 text-slate-700">
                                <Icons.MapPin className="w-5 h-5"/>
                                <span className="font-medium text-lg">{locationName}</span>
                            </div>
                            <div className="flex flex-col items-end">
                                <span className="text-sm font-medium text-slate-600 mb-1">{current.label}</span>
                                {current.icon}
                            </div>
                        </div>

                        <div className="mt-2 text-6xl font-light tracking-tighter text-slate-800">
                            {Math.round(weather.current.temperature_2m)}°C
                        </div>

                        <div className="flex space-x-3 mt-6">
                            <div className="flex items-center space-x-2 bg-slate-700/80 text-white px-3 py-1.5 rounded-full text-sm backdrop-blur-sm">
                                <Icons.Droplets className="w-4 h-4"/>
                                <span>{weather.current.relative_humidity_2m}%</span>
                            </div>
                            <div className="flex items-center space-x-2 bg-slate-700/80 text-white px-3 py-1.5 rounded-full text-sm backdrop-blur-sm">
                                <Icons.Wind className="w-4 h-4"/>
                                <span>{weather.current.wind_speed_10m} km/h</span>
                            </div>
                        </div>

                        {/* Hourly simple view */}
                        <div className="flex justify-between items-center mt-8 px-1">
                            <Icons.ChevronLeft className="w-5 h-5 text-slate-400"/>
                            {weather.hourly.time.slice(new Date().getHours(), new Date().getHours() + 4).map((t, i) => {
                                const idx = new Date().getHours() + i;
                                const code = weather.hourly.weather_code[idx];
                                const temp = weather.hourly.temperature_2m[idx];
                                return (
                                    <div key={t} className="flex flex-col items-center space-y-2">
                                        <span className="text-xs text-slate-500">{getHour(t)}</span>
                                        {getWeatherIcon(code, "w-6 h-6 text-slate-600").icon}
                                        <span className="text-sm font-bold">{Math.round(temp)}°</span>
                                    </div>
                                )
                            })}
                            <Icons.ChevronRight className="w-5 h-5 text-slate-600"/>
                        </div>
                    </div>

                    {/* BOTTOM SECTION */}
                    <div className="bg-slate-700 p-6 text-white">
                        <div className="flex flex-col space-y-4">
                            {weather.daily.time.slice(0, 5).map((d, i) => {
                                const code = weather.daily.weather_code[i];
                                const max = weather.daily.temperature_2m_max[i];
                                const min = weather.daily.temperature_2m_min[i];
                                return (
                                    <div key={d} className="flex items-center justify-between">
                                        <span className="w-24 font-medium">{i === 0 ? "Heute" : getDayName(d)}</span>
                                        <div className="flex-1 flex justify-center">
                                            {getWeatherIcon(code, "w-5 h-5 text-slate-300").icon}
                                        </div>
                                        <div className="w-20 flex justify-end space-x-3">
                                            <span className="font-semibold">{Math.round(max)}°</span>
                                            <span className="text-slate-400">{Math.round(min)}°</span>
                                        </div>
                                    </div>
                                )
                            })}
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>