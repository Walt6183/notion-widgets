<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Studio Clock Pro - Widget</title>
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700;800&display=swap');

        body, html { 
            background-color: transparent; /* Wichtig für Widget-Optik */
            margin: 0; 
            padding: 0;
            overflow: hidden;
            height: 100vh;
            width: 100vw;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        #root {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        svg {
            /* Das SVG skaliert sich immer passend zum Fenster */
            width: 100%;
            height: 100%;
            max-width: 100%;
            max-height: 100%;
            font-family: 'JetBrains Mono', monospace;
            filter: drop-shadow(0 0 10px rgba(0,0,0,0.5));
        }

        .glow-red { filter: drop-shadow(0 0 6px rgba(239, 68, 68, 0.7)); }
        .dot-glow { filter: drop-shadow(0 0 2px rgba(239, 68, 68, 0.9)); }
        
        /* Sanfter Puls-Effekt für ON AIR */
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.3; }
            100% { opacity: 1; }
        }
        .animate-pulse-red { animation: pulse 2s infinite ease-in-out; }
    </style>
</head>
<body>

    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        const App = () => {
            const [time, setTime] = useState(new Date());
            const [locationName, setLocationName] = useState("LOKAL");

            useEffect(() => {
                const interval = setInterval(() => setTime(new Date()), 50);
                
                // Standort-Ermittlung
                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(async (pos) => {
                        try {
                            const res = await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${pos.coords.latitude}&lon=${pos.coords.longitude}`);
                            const data = await res.json();
                            const city = data.address.city || data.address.town || "LOKAL";
                            setLocationName(city.toUpperCase());
                        } catch(e) {}
                    });
                }
                return () => clearInterval(interval);
            }, []);

            const hours = time.getHours().toString().padStart(2, '0');
            const minutes = time.getMinutes().toString().padStart(2, '0');
            const seconds = time.getSeconds();
            const ms = Math.floor(time.getMilliseconds() / 10).toString().padStart(2, '0');
            
            const dateStr = time.toLocaleDateString('de-DE', { 
                weekday: 'long', day: '2-digit', month: 'long', year: 'numeric' 
            }).toUpperCase();

            // Sekunden-Punkte (Koordinaten im 100x120 System)
            const dots = useMemo(() => {
                const temp = [];
                const radius = 42; 
                const centerX = 50;
                const centerY = 58; 
                for (let i = 0; i < 60; i++) {
                    const angle = (i * 6 - 90) * (Math.PI / 180);
                    temp.push({ 
                        x: centerX + radius * Math.cos(angle), 
                        y: centerY + radius * Math.sin(angle), 
                        index: i 
                    });
                }
                return temp;
            }, []);

            return (
                /* viewBox 0 0 100 120 stellt sicher, dass alles quadratisch bleibt */
                <svg viewBox="0 0 100 120" preserveAspectRatio="xMidYMid meet">
                    {/* Widget-Hintergrund (wie Apple Widgets) */}
                    <rect x="2" y="2" width="96" height="116" fill="rgba(0,0,0,0.85)" rx="8" />

                    {/* HEADER */}
                    <text x="7" y="10" fontSize="2" fontWeight="700" fill="#4b5563" letterSpacing="0.2">REFERENCE SYSTEM</text>
                    <text x="7" y="15" fontSize="4.5" fontWeight="800" fill="#f3f4f6" letterSpacing="-0.2">STUDIO MASTER</text>
                    <text x="93" y="15" fontSize="2.8" fontWeight="500" fill="#6b7280" textAnchor="end">{dateStr}</text>
                    <line x1="7" y1="18" x2="93" y2="18" stroke="#1f2937" strokeWidth="0.4" />

                    {/* CLOCK AREA */}
                    {dots.map((dot) => {
                        const isActive = dot.index <= seconds;
                        return (
                            <circle
                                key={dot.index}
                                cx={dot.x}
                                cy={dot.y}
                                r={isActive ? "0.9" : "0.5"}
                                fill={isActive ? "#ef4444" : "#111827"}
                                className={isActive ? "dot-glow" : ""}
                                style={{ transition: 'fill 0.3s ease' }}
                            />
                        );
                    })}

                    {/* Zeit HH:MM (Zentriert) */}
                    <text 
                        x="44" 
                        y="60" 
                        textAnchor="middle" 
                        dominantBaseline="middle" 
                        fill="white" 
                        fontSize="24" 
                        fontWeight="800" 
                        className="glow-red"
                        style={{ letterSpacing: '-1.5px' }}
                    >
                        {hours}:{minutes}
                    </text>

                    {/* Sekunden (Rechts daneben) */}
                    <text 
                        x="66" 
                        y="58" 
                        textAnchor="start" 
                        dominantBaseline="middle" 
                        fill="#ef4444" 
                        fontSize="10" 
                        fontWeight="700"
                    >
                        {seconds.toString().padStart(2, '0')}
                    </text>

                    {/* Millisekunden (Unter den Sekunden) */}
                    <text 
                        x="66" 
                        y="66" 
                        textAnchor="start" 
                        dominantBaseline="middle" 
                        fill="#3f3f46" 
                        fontSize="3.8" 
                        fontWeight="600"
                    >
                        .{ms}
                    </text>

                    {/* FOOTER */}
                    <line x1="7" y1="102" x2="93" y2="102" stroke="#1f2937" strokeWidth="0.4" />
                    
                    {/* Timezone */}
                    <text x="7" y="108" fontSize="2.2" fontWeight="700" fill="#4b5563">TIMEZONE</text>
                    <text x="7" y="113" fontSize="2.8" fontWeight="700" fill="#9ca3af">{locationName} (UTC+1)</text>

                    {/* Clock Sync */}
                    <text x="32" y="108" fontSize="2.2" fontWeight="700" fill="#4b5563">CLOCK SYNC</text>
                    <circle cx="33.5" cy="112.2" r="0.7" fill="#22c55e" />
                    <text x="35.5" y="113" fontSize="2.8" fontWeight="700" fill="#16a34a">LOCKED</text>

                    {/* ON AIR Indicator */}
                    <rect x="55" y="107" width="20" height="8" rx="1.5" fill="rgba(153, 27, 27, 0.15)" stroke="rgba(239, 68, 68, 0.3)" strokeWidth="0.3" />
                    <circle cx="59" cy="111" r="0.8" fill="#ef4444" className="animate-pulse-red" />
                    <text x="62" y="111.8" fontSize="3.5" fontWeight="900" fill="#ef4444" letterSpacing="0.4">ON AIR</text>

                    {/* Calendar */}
                    <text x="93" y="108" fontSize="2.2" fontWeight="700" fill="#4b5563" textAnchor="end">CALENDAR</text>
                    <text x="93" y="113" fontSize="3.8" fontWeight="700" fill="#d1d5db" textAnchor="end">KW {getWeekNumber(time)}</text>
                </svg>
            );
        };

        function getWeekNumber(d) {
            d = new Date(Date.UTC(d.getFullYear(), d.getMonth(), d.getDate()));
            d.setUTCDate(d.getUTCDate() + 4 - (d.getUTCDay() || 7));
            var yearStart = new Date(Date.UTC(d.getUTCFullYear(), 0, 1));
            return Math.ceil((((d - yearStart) / 86400000) + 1) / 7);
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
