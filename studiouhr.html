<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Studio Clock Pro - Widget</title>
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700;800&display=swap');

        body, html { 
            background-color: transparent; /* Erlaubt Transparenz in Plash */
            margin: 0; 
            padding: 0;
            overflow: hidden;
            height: 100vh;
            width: 100vw;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        svg {
            width: 100%;
            height: 100%;
            max-width: 100vw;
            max-height: 100vh;
            font-family: 'JetBrains Mono', monospace;
        }

        .glow-red { filter: drop-shadow(0 0 5px rgba(239, 68, 68, 0.8)); }
        .dot-glow { filter: drop-shadow(0 0 2px rgba(239, 68, 68, 0.9)); }
    </style>
</head>
<body>

    <div id="root" style="width: 100%; height: 100%;"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        const App = () => {
            const [time, setTime] = useState(new Date());
            const [locationName, setLocationName] = useState("LOKAL");

            useEffect(() => {
                const interval = setInterval(() => setTime(new Date()), 50);
                
                // Standort-Ermittlung
                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(async (pos) => {
                        try {
                            const res = await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${pos.coords.latitude}&lon=${pos.coords.longitude}`);
                            const data = await res.json();
                            const city = data.address.city || data.address.town || "LOKAL";
                            setLocationName(city.toUpperCase());
                        } catch(e) {}
                    });
                }
                return () => clearInterval(interval);
            }, []);

            const hours = time.getHours().toString().padStart(2, '0');
            const minutes = time.getMinutes().toString().padStart(2, '0');
            const seconds = time.getSeconds();
            const ms = Math.floor(time.getMilliseconds() / 10).toString().padStart(2, '0');
            
            const dateStr = time.toLocaleDateString('de-DE', { 
                weekday: 'long', day: '2-digit', month: 'long', year: 'numeric' 
            }).toUpperCase();

            // Sekunden-Punkte berechnen (Koordinaten im 100x120 System)
            const dots = useMemo(() => {
                const temp = [];
                const radius = 42; 
                const centerX = 50;
                const centerY = 60; // Zentriert im 120er System
                for (let i = 0; i < 60; i++) {
                    const angle = (i * 6 - 90) * (Math.PI / 180);
                    temp.push({ 
                        x: centerX + radius * Math.cos(angle), 
                        y: centerY + radius * Math.sin(angle), 
                        index: i 
                    });
                }
                return temp;
            }, []);

            return (
                <svg viewBox="0 0 100 120" preserveAspectRatio="xMidYMid meet">
                    {/* Hintergrund (Optional f√ºr bessere Lesbarkeit auf Desktop) */}
                    <rect width="100" height="120" fill="rgba(0,0,0,0.85)" rx="5" />

                    {/* HEADER */}
                    <text x="5" y="8" fontSize="2" fontWeight="700" fill="#4b5563" letterSpacing="0.2">REFERENCE SYSTEM</text>
                    <text x="5" y="13" fontSize="4" fontWeight="800" fill="#e5e7eb" letterSpacing="-0.2">STUDIO MASTER</text>
                    <text x="95" y="13" fontSize="2.5" fontWeight="500" fill="#6b7280" textAnchor="end">{dateStr}</text>
                    <line x1="5" y1="16" x2="95" y2="16" stroke="#18181b" strokeWidth="0.5" />

                    {/* CLOCK CENTER AREA */}
                    {dots.map((dot) => {
                        const isActive = dot.index <= seconds;
                        return (
                            <circle
                                key={dot.index}
                                cx={dot.x}
                                cy={dot.y}
                                r={isActive ? "0.9" : "0.5"}
                                fill={isActive ? "#ef4444" : "#1f2937"}
                                className={isActive ? "dot-glow" : ""}
                                style={{ transition: 'fill 0.3s ease' }}
                            />
                        );
                    })}

                    {/* Zeit: HH:MM */}
                    <text 
                        x="46" 
                        y="62" 
                        textAnchor="middle" 
                        dominantBaseline="middle" 
                        fill="white" 
                        fontSize="22" 
                        fontWeight="800" 
                        className="glow-red"
                        style={{ letterSpacing: '-1px' }}
                    >
                        {hours}:{minutes}
                    </text>

                    {/* Sekunden: SS */}
                    <text 
                        x="68" 
                        y="62" 
                        textAnchor="start" 
                        dominantBaseline="middle" 
                        fill="#ef4444" 
                        fontSize="9" 
                        fontWeight="700"
                    >
                        {seconds.toString().padStart(2, '0')}
                    </text>

                    {/* Millisekunden: .ms */}
                    <text 
                        x="68" 
                        y="69" 
                        textAnchor="start" 
                        dominantBaseline="middle" 
                        fill="#3f3f46" 
                        fontSize="3.5" 
                        fontWeight="600"
                    >
                        .{ms}
                    </text>

                    {/* FOOTER */}
                    <line x1="5" y1="104" x2="95" y2="104" stroke="#18181b" strokeWidth="0.5" />
                    
                    {/* Timezone */}
                    <text x="5" y="110" fontSize="2" fontWeight="700" fill="#4b5563">TIMEZONE</text>
                    <text x="5" y="114" fontSize="2.5" fontWeight="700" fill="#9ca3af">{locationName} (UTC+1)</text>

                    {/* Clock Sync */}
                    <text x="28" y="110" fontSize="2" fontWeight="700" fill="#4b5563">CLOCK SYNC</text>
                    <circle cx="29" cy="113.5" r="0.6" fill="#22c55e" />
                    <text x="31" y="114" fontSize="2.5" fontWeight="700" fill="#16a34a">LOCKED</text>

                    {/* ON AIR Box */}
                    <rect x="52" y="108" width="18" height="8" rx="1" fill="rgba(153, 27, 27, 0.1)" stroke="rgba(153, 27, 27, 0.3)" strokeWidth="0.3" />
                    <circle cx="56" cy="112" r="0.8" fill="#ef4444">
                        <animate attributeName="opacity" values="1;0.3;1" dur="2s" repeatCount="indefinite" />
                    </circle>
                    <text x="59" y="112.5" fontSize="3.5" fontWeight="900" fill="#ef4444" letterSpacing="0.5">ON AIR</text>

                    {/* Calendar */}
                    <text x="95" y="110" fontSize="2" fontWeight="700" fill="#4b5563" textAnchor="end">CALENDAR</text>
                    <text x="95" y="114" fontSize="3.5" fontWeight="700" fill="#d1d5db" textAnchor="end">KW {getWeekNumber(time)}</text>
                </svg>
            );
        };

        function getWeekNumber(d) {
            d = new Date(Date.UTC(d.getFullYear(), d.getMonth(), d.getDate()));
            d.setUTCDate(d.getUTCDate() + 4 - (d.getUTCDay() || 7));
            var yearStart = new Date(Date.UTC(d.getUTCFullYear(), 0, 1));
            return Math.ceil((((d - yearStart) / 86400000) + 1) / 7);
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
