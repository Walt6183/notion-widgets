<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Studio Clock Pro</title>
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700;800&display=swap');

        :root {
            --bg-color: #000000;
        }

        body, html { 
            background-color: var(--bg-color); 
            margin: 0; 
            padding: 0;
            overflow: hidden;
            font-family: 'JetBrains Mono', monospace;
            color: white;
            height: 100%;
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        #root {
            height: 100%;
            width: 100%;
        }

        .glow-red {
            text-shadow: 0 0 15px rgba(239, 68, 68, 0.5);
        }

        .dot-glow {
            filter: drop-shadow(0 0 4px rgba(239, 68, 68, 0.8));
        }

        * {
            user-select: none;
            -webkit-user-drag: none;
            box-sizing: border-box;
        }
    </style>
</head>
<body>

    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        const App = () => {
            const [time, setTime] = useState(new Date());
            const [locationName, setLocationName] = useState("LOKAL");
            const [dimensions, setDimensions] = useState({ 
                width: window.innerWidth, 
                height: window.innerHeight 
            });

            useEffect(() => {
                const interval = setInterval(() => setTime(new Date()), 50);
                const handleResize = () => setDimensions({ width: window.innerWidth, height: window.innerHeight });
                window.addEventListener('resize', handleResize);

                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(async (pos) => {
                        try {
                            const res = await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${pos.coords.latitude}&lon=${pos.coords.longitude}`);
                            const data = await res.json();
                            const city = data.address.city || data.address.town || "LOKAL";
                            setLocationName(city.toUpperCase());
                        } catch(e) {}
                    });
                }

                return () => {
                    clearInterval(interval);
                    window.removeEventListener('resize', handleResize);
                };
            }, []);

            const hours = time.getHours().toString().padStart(2, '0');
            const minutes = time.getMinutes().toString().padStart(2, '0');
            const seconds = time.getSeconds();
            const ms = Math.floor(time.getMilliseconds() / 10).toString().padStart(2, '0');
            
            const dateStr = time.toLocaleDateString('de-DE', { 
                weekday: 'short', day: '2-digit', month: 'short'
            }).toUpperCase();

            const dots = useMemo(() => {
                const temp = [];
                const radius = 44; 
                for (let i = 0; i < 60; i++) {
                    const angle = (i * 6 - 90) * (Math.PI / 180);
                    temp.push({ x: 50 + radius * Math.cos(angle), y: 50 + radius * Math.sin(angle), index: i });
                }
                return temp;
            }, []);

            const minSide = Math.min(dimensions.width, dimensions.height);
            const isVerySmall = minSide < 250;
            const isMedium = minSide < 500;
            
            // Verhindert, dass die Uhr jemals den Rand berÃ¼hrt
            const clockPx = minSide * (isVerySmall ? 0.85 : 0.75);

            return (
                <div className="h-full w-full flex flex-col items-center justify-between p-3 md:p-6 overflow-hidden">
                    
                    {/* Header */}
                    <div className="w-full flex justify-between items-end border-b border-zinc-900 pb-1.5 opacity-60">
                        <div className="flex flex-col">
                            <span className="text-zinc-600 text-[6px] md:text-[9px] font-bold tracking-widest uppercase">Ref System</span>
                            <span className="text-[10px] md:text-lg font-black tracking-tighter text-zinc-300">STUDIO MASTER</span>
                        </div>
                        <div className="text-right">
                            <span className="text-zinc-500 text-[8px] md:text-xs font-bold tracking-wider">{dateStr}</span>
                        </div>
                    </div>

                    {/* Clock Circle */}
                    <div style={{ width: clockPx, height: clockPx }} className="relative flex items-center justify-center shrink-0">
                        <svg viewBox="0 0 100 100" className="absolute inset-0 w-full h-full pointer-events-none overflow-visible">
                            {dots.map((dot) => {
                                const isActive = dot.index <= seconds;
                                return (
                                    <circle
                                        key={dot.index}
                                        cx={dot.x}
                                        cy={dot.y}
                                        r={isActive ? (isVerySmall ? "1.2" : "1.0") : "0.5"}
                                        className={`transition-all duration-300 ${isActive ? 'fill-red-600 dot-glow' : 'fill-zinc-800'}`}
                                    />
                                );
                            })}
                        </svg>

                        <div className="flex flex-col items-center">
                            <div className="flex items-baseline">
                                <span style={{ fontSize: clockPx * 0.23 }} className="font-black tracking-tighter tabular-nums glow-red leading-none">
                                    {hours}:{minutes}
                                </span>
                                {!isVerySmall && (
                                    <div className="flex flex-col ml-1.5 md:ml-3">
                                        <span style={{ fontSize: clockPx * 0.09 }} className="font-bold text-red-600 tabular-nums leading-none">
                                            {seconds.toString().padStart(2, '0')}
                                        </span>
                                        {!isMedium && (
                                            <span style={{ fontSize: clockPx * 0.035 }} className="text-zinc-700 font-bold tabular-nums mt-0.5">.{ms}</span>
                                        )}
                                    </div>
                                )}
                            </div>
                            {isVerySmall && (
                                <span style={{ fontSize: clockPx * 0.1 }} className="font-bold text-red-600 tabular-nums -mt-1">{seconds.toString().padStart(2, '0')}</span>
                            )}
                        </div>
                    </div>

                    {/* Footer */}
                    <div className="w-full flex justify-between items-center border-t border-zinc-900 pt-2 opacity-60">
                        <div className="flex space-x-2 md:space-x-8">
                            <div className="flex flex-col">
                                <span className="text-[6px] md:text-[8px] text-zinc-600 font-bold uppercase mb-0.5">Loc</span>
                                <span className="text-[8px] md:text-xs font-bold text-zinc-400 truncate max-w-[40px] md:max-w-none">{locationName}</span>
                            </div>
                            {!isVerySmall && (
                                <div className="flex flex-col border-l border-zinc-900 pl-2 md:pl-4">
                                    <span className="text-[6px] md:text-[8px] text-zinc-600 font-bold uppercase mb-0.5">Sync</span>
                                    <div className="flex items-center space-x-1">
                                        <div className="h-1 w-1 rounded-full bg-green-500 shadow-[0_0_4px_#22c55e]"></div>
                                        <span className="text-[7px] md:text-[10px] font-bold text-green-600 uppercase">Lock</span>
                                    </div>
                                </div>
                            )}
                        </div>

                        <div className="bg-red-950/20 border border-red-900/40 px-2 md:px-5 py-0.5 md:py-1 rounded flex items-center space-x-1 md:space-x-2">
                            <div className="h-1 w-1 md:h-2 md:w-2 rounded-full bg-red-600 animate-pulse"></div>
                            <span className="text-red-500 font-black text-[7px] md:text-sm tracking-widest uppercase">On Air</span>
                        </div>

                        <div className="flex flex-col items-end">
                            <span className="text-[6px] md:text-[8px] text-zinc-600 font-bold uppercase mb-0.5">KW</span>
                            <span className="text-[9px] md:text-sm font-bold text-zinc-300 uppercase leading-none">{getWeekNumber(time)}</span>
                        </div>
                    </div>
                </div>
            );
        };

        function getWeekNumber(d) {
            d = new Date(Date.UTC(d.getFullYear(), d.getMonth(), d.getDate()));
            d.setUTCDate(d.getUTCDate() + 4 - (d.getUTCDay() || 7));
            var yearStart = new Date(Date.UTC(d.getUTCFullYear(), 0, 1));
            return Math.ceil((((d - yearStart) / 86400000) + 1) / 7);
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
