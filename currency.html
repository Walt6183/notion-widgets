<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WÃ¤hrungsrechner</title>
    
    <!-- React & Tailwind laden -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        body { background-color: transparent; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; }
        ::-webkit-scrollbar { width: 0px; background: transparent; }
        /* Pfeile im Nummer-Feld verstecken */
        input[type=number]::-webkit-inner-spin-button, 
        input[type=number]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
    </style>
</head>
<body class="bg-stone-50 h-screen flex items-center justify-center overflow-hidden">

    <div id="root" class="w-full h-full flex items-center justify-center"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        const App = () => {
            const [rates, setRates] = useState({});
            const [lastUpdate, setLastUpdate] = useState(null);
            const [loading, setLoading] = useState(true);
            const [error, setError] = useState(null);
            
            // Rechner State
            const [amount, setAmount] = useState(1);
            const [selectedCurr, setSelectedCurr] = useState('EUR');

            const currencies = [
                { code: 'EUR', name: 'Euro', flag: 'ðŸ‡ªðŸ‡º', scale: 1 },
                { code: 'USD', name: 'US Dollar', flag: 'ðŸ‡ºðŸ‡¸', scale: 1 },
                { code: 'GBP', name: 'Pfund', flag: 'ðŸ‡¬ðŸ‡§', scale: 1 },
                { code: 'NOK', name: 'Norw. Krone', flag: 'ðŸ‡³ðŸ‡´', scale: 100 },
                { code: 'SEK', name: 'Schwed. Krone', flag: 'ðŸ‡¸ðŸ‡ª', scale: 100 },
                { code: 'DKK', name: 'DÃ¤n. Krone', flag: 'ðŸ‡©ðŸ‡°', scale: 100 },
            ];

            // Icons direkt als SVG definiert, damit keine Importe nÃ¶tig sind (wie in den VorgÃ¤ngerversionen)
            const RefreshIcon = ({className}) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M8 16H3v5"/></svg>;
            const WalletIcon = ({className}) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M19 7V4a1 1 0 0 0-1-1H5a2 2 0 0 0 0 4h15a1 1 0 0 1 1 1v4h-3a2 2 0 0 0 0 4h3a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1"/><path d="M3 5v14a2 2 0 0 0 2 2h15a1 1 0 0 0 1-1v-4"/></svg>;
            const ArrowRightIcon = ({className}) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M5 12h14"/><path d="m12 5 7 7-7 7"/></svg>;

            const fetchRates = async () => {
                setLoading(true);
                try {
                    const res = await fetch('https://open.er-api.com/v6/latest/CHF');
                    const data = await res.json();
                    setRates(data.rates);
                    const date = new Date(data.time_last_update_utc);
                    // Sicherere Formatierung fÃ¼r Browser-KompatibilitÃ¤t
                    const dateStr = date.getDate().toString().padStart(2,'0') + '.' + (date.getMonth()+1).toString().padStart(2,'0') + '.' + date.getFullYear();
                    setLastUpdate(dateStr);
                    setLoading(false);
                } catch (err) {
                    setError("Fehler beim Laden");
                    setLoading(false);
                }
            };

            useEffect(() => { fetchRates(); }, []);

            const calculateRate = (code, scale) => {
                if (!rates[code]) return "---";
                const inverse = (1 / rates[code]) * scale;
                return inverse.toFixed(2);
            };

            const calculateConversion = () => {
                if (!rates[selectedCurr] || !amount) return "---";
                const result = amount / rates[selectedCurr];
                return result.toFixed(2);
            };

            return (
                <div className="w-full max-w-sm overflow-hidden rounded-2xl bg-white shadow-lg ring-1 ring-black/5 font-sans">
                    {/* Header */}
                    <div className="bg-emerald-600 p-6 text-white">
                        <div className="flex items-center justify-between">
                            <div className="flex items-center space-x-2">
                                <WalletIcon className="h-6 w-6 text-emerald-100" />
                                <h2 className="text-xl font-bold tracking-tight">Wechselkurse</h2>
                            </div>
                            <span className="rounded-full bg-emerald-500/50 px-3 py-1 text-xs font-medium text-emerald-50 backdrop-blur-sm">Basis CHF</span>
                        </div>
                        <div className="mt-4 flex items-center justify-between text-emerald-100">
                            <span className="text-xs">{loading ? "Aktualisiere..." : `Stand: ${lastUpdate}`}</span>
                            <button onClick={fetchRates} disabled={loading} className={`rounded-full p-1.5 hover:bg-emerald-500/50 transition-colors ${loading ? 'animate-spin' : ''}`}>
                                <RefreshIcon className="h-4 w-4" />
                            </button>
                        </div>
                    </div>

                    {/* Liste */}
                    <div className="max-h-64 overflow-y-auto flex flex-col divide-y divide-stone-100 bg-white">
                        {!error && currencies.map((curr) => (
                            <div key={curr.code} className="group flex items-center justify-between px-6 py-3 transition-colors hover:bg-stone-50">
                                <div className="flex items-center space-x-4">
                                    <span className="text-2xl drop-shadow-sm filter grayscale transition-all group-hover:grayscale-0 cursor-default">{curr.flag}</span>
                                    <div className="flex flex-col">
                                        <span className="text-sm font-semibold text-stone-700">{curr.scale} {curr.code}</span>
                                        <span className="text-xs text-stone-400">{curr.name}</span>
                                    </div>
                                </div>
                                <div className="flex items-center space-x-2">
                                    {loading ? <div className="h-6 w-16 animate-pulse rounded bg-stone-100"></div> : (
                                        <>
                                            <span className="text-lg font-bold text-stone-800 tabular-nums tracking-tight">{calculateRate(curr.code, curr.scale)}</span>
                                            <span className="text-xs font-medium text-stone-400">CHF</span>
                                        </>
                                    )}
                                </div>
                            </div>
                        ))}
                    </div>

                    {/* Rechner */}
                    <div className="bg-stone-50 p-6 border-t border-stone-100">
                        <h3 className="mb-3 text-xs font-bold uppercase tracking-wider text-stone-400">Umrechner</h3>
                        <div className="flex items-center space-x-2 mb-4">
                            <div className="relative flex-1">
                                <input type="number" value={amount} onChange={(e) => setAmount(parseFloat(e.target.value) || 0)} className="w-full rounded-lg border-stone-200 bg-white py-2 pl-3 pr-12 text-sm font-semibold text-stone-700 shadow-sm focus:border-emerald-500 focus:ring-emerald-500 outline-none border" placeholder="0.00"/>
                            </div>
                            <div className="relative w-24">
                                <select value={selectedCurr} onChange={(e) => setSelectedCurr(e.target.value)} className="w-full appearance-none rounded-lg border-stone-200 bg-white py-2 pl-3 pr-8 text-sm font-bold text-stone-700 shadow-sm focus:border-emerald-500 focus:ring-emerald-500 outline-none border">
                                    {currencies.map(c => <option key={c.code} value={c.code}>{c.code}</option>)}
                                </select>
                                <div className="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-stone-500">
                                    <svg className="h-4 w-4 fill-current" viewBox="0 0 20 20"><path d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"/></svg>
                                </div>
                            </div>
                        </div>
                        <div className="flex items-center justify-between rounded-lg bg-emerald-50 p-3 text-emerald-900">
                            <div className="flex items-center space-x-2 text-sm opacity-70"><span>in CHF</span><ArrowRightIcon className="h-4 w-4"/></div>
                            <span className="text-xl font-bold tabular-nums tracking-tight">{loading ? "..." : calculateConversion()} <span className="text-sm font-medium opacity-60">CHF</span></span>
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
