import React, { useState, useEffect } from 'react';
import { RefreshCw, Wallet, ArrowRight } from 'lucide-react';

export default function App() {
  const [rates, setRates] = useState({});
  const [lastUpdate, setLastUpdate] = useState(null);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);

  // Rechner State
  const [amount, setAmount] = useState(1);
  const [selectedCurr, setSelectedCurr] = useState('EUR');

  // Die gewÃ¼nschten WÃ¤hrungen
  const currencies = [
    { code: 'EUR', name: 'Euro', flag: 'ðŸ‡ªðŸ‡º', scale: 1 },
    { code: 'USD', name: 'US Dollar', flag: 'ðŸ‡ºðŸ‡¸', scale: 1 },
    { code: 'GBP', name: 'Pfund', flag: 'ðŸ‡¬ðŸ‡§', scale: 1 },
    { code: 'NOK', name: 'Norw. Krone', flag: 'ðŸ‡³ðŸ‡´', scale: 100 },
    { code: 'SEK', name: 'Schwed. Krone', flag: 'ðŸ‡¸ðŸ‡ª', scale: 100 },
    { code: 'DKK', name: 'DÃ¤n. Krone', flag: 'ðŸ‡©ðŸ‡°', scale: 100 },
  ];

  const fetchRates = async () => {
    setLoading(true);
    try {
      const res = await fetch('https://open.er-api.com/v6/latest/CHF');
      const data = await res.json();
      
      setRates(data.rates);
      const date = new Date(data.time_last_update_utc);
      setLastUpdate(date.toLocaleDateString('de-CH', { 
        day: '2-digit', month: '2-digit', year: 'numeric' 
      }));
      setLoading(false);
    } catch (err) {
      console.error(err);
      setError("Fehler beim Laden");
      setLoading(false);
    }
  };

  useEffect(() => {
    fetchRates();
  }, []);

  // Umrechnung fÃ¼r die Liste (1 Fremd = X CHF)
  const calculateRate = (code, scale) => {
    if (!rates[code]) return "---";
    const inverseRate = (1 / rates[code]) * scale;
    return inverseRate.toFixed(2);
  };

  // Umrechnung fÃ¼r den Rechner (X Fremd = Y CHF)
  const calculateConversion = () => {
    if (!rates[selectedCurr] || !amount) return "---";
    // Formel: Betrag / Rate (da Rate = Wieviel Fremd pro 1 CHF)
    const result = amount / rates[selectedCurr];
    return result.toFixed(2);
  };

  return (
    <div className="flex h-screen w-full items-center justify-center bg-stone-50 p-4 font-sans">
      
      <div className="w-full max-w-sm overflow-hidden rounded-2xl bg-white shadow-lg ring-1 ring-black/5">
        
        {/* Header */}
        <div className="bg-emerald-600 p-6 text-white">
          <div className="flex items-center justify-between">
            <div className="flex items-center space-x-2">
              <Wallet className="h-6 w-6 text-emerald-100" />
              <h2 className="text-xl font-bold tracking-tight">Wechselkurse</h2>
            </div>
            <span className="rounded-full bg-emerald-500/50 px-3 py-1 text-xs font-medium text-emerald-50 backdrop-blur-sm">
              Basis CHF
            </span>
          </div>
          <div className="mt-4 flex items-center justify-between text-emerald-100">
            <span className="text-xs">
              {loading ? "Aktualisiere..." : `Stand: ${lastUpdate}`}
            </span>
            <button 
              onClick={fetchRates} 
              disabled={loading}
              className={`rounded-full p-1.5 hover:bg-emerald-500/50 transition-colors ${loading ? 'animate-spin' : ''}`}
            >
              <RefreshCw className="h-4 w-4" />
            </button>
          </div>
        </div>

        {/* Liste */}
        <div className="max-h-64 overflow-y-auto flex flex-col divide-y divide-stone-100 bg-white scrollbar-hide">
          {!error && currencies.map((curr) => (
            <div key={curr.code} className="group flex items-center justify-between px-6 py-3 transition-colors hover:bg-stone-50">
              <div className="flex items-center space-x-4">
                <span className="text-2xl drop-shadow-sm filter grayscale transition-all group-hover:grayscale-0">
                  {curr.flag}
                </span>
                <div className="flex flex-col">
                  <span className="text-sm font-semibold text-stone-700">
                    {curr.scale} {curr.code}
                  </span>
                  <span className="text-xs text-stone-400">{curr.name}</span>
                </div>
              </div>
              <div className="flex items-center space-x-2">
                {loading ? (
                  <div className="h-6 w-16 animate-pulse rounded bg-stone-100"></div>
                ) : (
                  <>
                    <span className="text-lg font-bold text-stone-800 tabular-nums tracking-tight">
                      {calculateRate(curr.code, curr.scale)}
                    </span>
                    <span className="text-xs font-medium text-stone-400">CHF</span>
                  </>
                )}
              </div>
            </div>
          ))}
        </div>

        {/* Rechner Bereich */}
        <div className="bg-stone-50 p-6 border-t border-stone-100">
          <h3 className="mb-3 text-xs font-bold uppercase tracking-wider text-stone-400">Umrechner</h3>
          
          <div className="flex items-center space-x-2 mb-4">
            {/* Betrag Input */}
            <div className="relative flex-1">
              <input
                type="number"
                value={amount}
                onChange={(e) => setAmount(parseFloat(e.target.value) || 0)}
                className="w-full rounded-lg border-stone-200 bg-white py-2 pl-3 pr-12 text-sm font-semibold text-stone-700 shadow-sm focus:border-emerald-500 focus:ring-emerald-500"
                placeholder="0.00"
              />
            </div>

            {/* WÃ¤hrung Select */}
            <div className="relative w-24">
              <select
                value={selectedCurr}
                onChange={(e) => setSelectedCurr(e.target.value)}
                className="w-full appearance-none rounded-lg border-stone-200 bg-white py-2 pl-3 pr-8 text-sm font-bold text-stone-700 shadow-sm focus:border-emerald-500 focus:ring-emerald-500"
              >
                {currencies.map(c => <option key={c.code} value={c.code}>{c.code}</option>)}
              </select>
              <div className="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-stone-500">
                <svg className="h-4 w-4 fill-current" viewBox="0 0 20 20"><path d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"/></svg>
              </div>
            </div>
          </div>

          {/* Ergebnis Zeile */}
          <div className="flex items-center justify-between rounded-lg bg-emerald-50 p-3 text-emerald-900">
            <div className="flex items-center space-x-2 text-sm opacity-70">
              <span>in CHF</span>
              <ArrowRight className="h-4 w-4" />
            </div>
            <span className="text-xl font-bold tabular-nums tracking-tight">
              {loading ? "..." : calculateConversion()} <span className="text-sm font-medium opacity-60">CHF</span>
            </span>
          </div>
        </div>

      </div>
    </div>
  );
}